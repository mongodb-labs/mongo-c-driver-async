
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Creating Asynchronous Loops &#8212; amongoc 0.1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles.css?v=9c410b61" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=e7471476"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'how-to/looping';</script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Reference" href="../../ref/" />
    <link rel="prev" title="Connect to a Server" href="../connect/" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search/"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../">
  
  
  
  
  
  
    <p class="title logo__title">amongoc 0.1.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../learn/">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../learn/bson/">BSON Handling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../learn/bson/lifetime/">Creation &amp; Destruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../learn/bson/inserting/">Adding Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../learn/bson/reading/">Reading BSON Data</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../learn/box/">Storing Values in a Type-Erased Box</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../">How-to Guides</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../connect/">Connect to a Server</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Creating Asynchronous Loops</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ref/">Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ref/meta-attrs/">Meta-Reference: Documentation Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/api-patterns/"><code class="project-name docutils literal notranslate"><span class="pre">amongoc</span></code> API Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/building/">Configuring, Building, &amp; Using</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/box/">Dynamically Types Boxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/status/">Status Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/emitter/">Emitter API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/operation/">Operation API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/async/">Asynchronous Utility APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/alloc/">Dynamic Memory Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/client/">Client API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/database/">Database Handle API</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../ref/collection/">Collection &amp; Data API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../ref/coll-ops/">Collection Operations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/params/">Common Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/aggregate/">Aggregate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/count/">Count</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/delete/">Delete</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/distinct/">Distinct</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/drop/">Drop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/find/">Find</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/insert/">Insert</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/replace/">Replace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ref/coll-ops/update/">Update</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/loop/">Type: <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_loop</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/handler/">Handler APIs</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../ref/bson/">BSON Library</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ref/bson/types/">BSON Value Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref/bson/value/">BSON Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref/bson/view/">BSON Reading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref/bson/iter/">BSON Iteration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref/bson/doc/">BSON Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ref/bson/mut/">BSON Modifying</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/str/">Strings &amp; String Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/vec/">Vector Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/time/">Time Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/glossary/">Terminology</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../explain/">Design &amp; Explanation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../explain/why-async/">Why Asynchrony?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../explain/consider/">Design Considerations in <code class="project-name docutils literal notranslate"><span class="pre">amongoc</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../explain/async-model/">Our Asynchrony Model</a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dev/"><code class="project-name docutils literal notranslate"><span class="pre">amongoc</span></code> Developer Documentation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dev/guidelines/">Development Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/deletion/">C Object Deletion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/nanosenders/">Nanosenders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/coroutines/">Couroutines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/result/"><code class="docutils literal notranslate"><span class="pre">result&lt;T&gt;</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/queries/">Query Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/asio/">Asio in <code class="project-name docutils literal notranslate"><span class="pre">amongoc</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/tls/">TLS Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/documenting/">Documenting <code class="project-name docutils literal notranslate"><span class="pre">amongoc</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/bson-building/">Declaratively Building BSON Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dev/bson-parsing/">Declaratively Parsing BSON Objects</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/how-to/looping.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Creating Asynchronous Loops</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-example-program">The Example Program</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initiating-the-program">Initiating the Program</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loop-stepping">Loop Stepping</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#printing-a-mesage-accumulating-a-sum">Printing a Mesage &amp; Accumulating a Sum</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-stop-condition">Checking the Stop Condition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-a-timer">Starting a Timer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#continuing-the-loop">Continuing the Loop</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-and-running-the-loop">Starting and Running the Loop</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-the-operation">Starting the Operation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-loop-and-finalizing-the-operation">Running the Loop and Finalizing the Operation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling-and-printing-the-final-result">Error Handling and Printing the Final Result</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="creating-asynchronous-loops">
<h1>Creating Asynchronous Loops<a class="headerlink" href="#creating-asynchronous-loops" title="Link to this heading">#</a></h1>
<p>The control flow loop is one of the most fundamental programming constructs. The
abstractions in <code class="project-name docutils literal notranslate"><span class="pre">amongoc</span></code> let you define asynchronous loops, where each loop
step is itself an asynchronous operation. The core API that enables looping is
<a class="reference internal" href="../../ref/async/#_CPPv411amongoc_let15amongoc_emitter19amongoc_async_flags14mlib_allocator11amongoc_box23amongoc_let_transformer" title="amongoc_let"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_let()</span></code></a>.</p>
<section id="the-example-program">
<h2>The Example Program<a class="headerlink" href="#the-example-program" title="Link to this heading">#</a></h2>
<p>The behavior of the sample program is very simple: Accept a positive integer as
a command line argument, and delay for that many seconds, printing a message and
accumulating a sum each second as the countdown runs. This guide will explain
the following program:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">looping.example.c</span></code></span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;amongoc/amongoc.h&gt;</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="cm">/**</span>
<span class="linenos"> 7</span><span class="cm"> * @brief State for the program</span>
<span class="linenos"> 8</span><span class="cm"> */</span>
<span class="linenos"> 9</span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">10</span><span class="w">    </span><span class="c1">// The countdown to zero</span>
<span class="linenos">11</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">countdown</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">    </span><span class="c1">// The event loop for the operation</span>
<span class="linenos">13</span><span class="w">    </span><span class="kt">amongoc_loop</span><span class="o">*</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
<span class="linenos">14</span><span class="w">    </span><span class="c1">// Fibonacci state</span>
<span class="linenos">15</span><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="linenos">16</span><span class="p">}</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="cm">/** loop_step()</span>
<span class="linenos">19</span><span class="cm"> * @brief Handle each step of our looping operation</span>
<span class="linenos">20</span><span class="cm"> *</span>
<span class="linenos">21</span><span class="cm"> * @param state_ptr Pointer to the `state` for the program</span>
<span class="linenos">22</span><span class="cm"> */</span>
<span class="linenos">23</span><span class="kt">amongoc_emitter</span><span class="w"> </span><span class="n">loop_step</span><span class="p">(</span><span class="kt">amongoc_box</span><span class="w"> </span><span class="n">state_ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">amongoc_status</span><span class="w"> </span><span class="n">prev_status</span><span class="p">,</span><span class="w"> </span><span class="kt">amongoc_box</span><span class="w"> </span><span class="n">prev_res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">24</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">prev_res</span><span class="p">;</span>
<span class="linenos">25</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">prev_status</span><span class="p">;</span>
<span class="linenos">26</span><span class="w">    </span><span class="c1">// Print our status</span>
<span class="linenos">27</span><span class="w">    </span><span class="n">state</span><span class="o">*</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">amongoc_box_cast</span><span class="p">(</span><span class="n">state</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">state_ptr</span><span class="p">);</span>
<span class="linenos">28</span><span class="w">    </span><span class="c1">// Compute the next sum and shift our numbers</span>
<span class="linenos">29</span><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">;</span>
<span class="linenos">30</span><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">;</span>
<span class="linenos">31</span><span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">;</span>
<span class="linenos">32</span><span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">b</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%d seconds remain, current value: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">countdown</span><span class="p">,</span><span class="w"> </span><span class="n">cur</span><span class="p">);</span>
<span class="linenos">34</span><span class="w">    </span><span class="c1">// Check if we are done</span>
<span class="linenos">35</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">countdown</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">36</span><span class="w">        </span><span class="c1">// No more looping to do. Return a final null result</span>
<span class="linenos">37</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">amongoc_just</span><span class="p">(</span><span class="no">amongoc_okay</span><span class="p">,</span>
<span class="linenos">38</span><span class="w">                            </span><span class="nf">amongoc_box_uint64</span><span class="p">(</span><span class="n">cur</span><span class="p">),</span>
<span class="linenos">39</span><span class="w">                            </span><span class="nf">amongoc_loop_get_allocator</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">loop</span><span class="p">));</span>
<span class="linenos">40</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">41</span><span class="w">    </span><span class="c1">// Decrement the counter and start a sleep of one second</span>
<span class="linenos">42</span><span class="w">    </span><span class="o">--</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">countdown</span><span class="p">;</span>
<span class="linenos">43</span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">timespec</span><span class="w"> </span><span class="n">dur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">tv_sec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<span class="linenos">44</span><span class="w">    </span><span class="kt">amongoc_emitter</span><span class="w"> </span><span class="n">em</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nf">amongoc_schedule_later</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">dur</span><span class="p">);</span>
<span class="linenos">45</span><span class="w">    </span><span class="c1">// Connect the sleep to this function so that we will be called again after</span>
<span class="linenos">46</span><span class="w">    </span><span class="c1">// the delay has elapsed. Return this as the new operation for the loop.</span>
<span class="linenos">47</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">amongoc_let</span><span class="p">(</span><span class="n">em</span><span class="p">,</span>
<span class="linenos">48</span><span class="w">                       </span><span class="no">amongoc_async_forward_errors</span><span class="p">,</span>
<span class="linenos">49</span><span class="w">                       </span><span class="nf">amongoc_loop_get_allocator</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">loop</span><span class="p">),</span>
<span class="linenos">50</span><span class="w">                       </span><span class="n">state_ptr</span><span class="p">,</span>
<span class="linenos">51</span><span class="w">                       </span><span class="n">loop_step</span><span class="p">);</span>
<span class="linenos">52</span><span class="p">}</span>
<span class="linenos">53</span><span class="c1">// end.</span>
<span class="linenos">54</span>
<span class="linenos">55</span><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">56</span><span class="w">    </span><span class="c1">// Parse a delay integer from the command-line arguments</span>
<span class="linenos">57</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">58</span><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Usage: %s &lt;delay&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos">59</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="linenos">60</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">61</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="linenos">62</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(((</span><span class="n">delay</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">63</span><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Expected &lt;delay&gt; to be a positive integer</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">64</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="linenos">65</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">66</span>
<span class="linenos">67</span><span class="w">    </span><span class="c1">// Create a default loop</span>
<span class="linenos">68</span><span class="w">    </span><span class="kt">amongoc_loop</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
<span class="linenos">69</span><span class="w">    </span><span class="nf">amongoc_default_loop_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">loop</span><span class="p">);</span>
<span class="linenos">70</span>
<span class="linenos">71</span><span class="w">    </span><span class="c1">// Seed the initial sum</span>
<span class="linenos">72</span><span class="w">    </span><span class="n">state</span><span class="w"> </span><span class="n">app_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">countdown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delay</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<span class="linenos">73</span>
<span class="linenos">74</span><span class="w">    </span><span class="c1">// Start the loop</span>
<span class="linenos">75</span><span class="w">    </span><span class="kt">amongoc_emitter</span><span class="w"> </span><span class="n">em</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop_step</span><span class="p">(</span><span class="nf">amongoc_box_pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">app_state</span><span class="p">),</span><span class="w"> </span><span class="no">amongoc_okay</span><span class="p">,</span><span class="w"> </span><span class="no">amongoc_nil</span><span class="p">);</span>
<span class="linenos">76</span><span class="w">    </span><span class="c1">// Tie the final result for later, and start the program</span>
<span class="linenos">77</span><span class="w">    </span><span class="kt">amongoc_status</span><span class="w">    </span><span class="n">status</span><span class="p">;</span>
<span class="linenos">78</span><span class="w">    </span><span class="kt">amongoc_box</span><span class="w">       </span><span class="n">result</span><span class="p">;</span>
<span class="linenos">79</span><span class="w">    </span><span class="kt">amongoc_operation</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">amongoc_tie</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="no">mlib_default_allocator</span><span class="p">);</span>
<span class="linenos">80</span><span class="w">    </span><span class="nf">amongoc_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">op</span><span class="p">);</span>
<span class="linenos">81</span><span class="w">    </span><span class="c1">// Run the program within the event loop</span>
<span class="linenos">82</span><span class="w">    </span><span class="nf">amongoc_default_loop_run</span><span class="p">(</span><span class="o">&amp;</span><span class="n">loop</span><span class="p">);</span>
<span class="linenos">83</span><span class="w">    </span><span class="nf">amongoc_operation_delete</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>
<span class="linenos">84</span><span class="w">    </span><span class="nf">amongoc_default_loop_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">loop</span><span class="p">);</span>
<span class="linenos">85</span>
<span class="linenos">86</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">amongoc_is_error</span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">87</span><span class="w">        </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">amongoc_status_strdup_message</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="linenos">88</span><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;error: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">89</span><span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">90</span><span class="w">        </span><span class="nf">amongoc_box_destroy</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="linenos">91</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="linenos">92</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">93</span><span class="w">        </span><span class="c1">// Get the value returned with `amongoc_just` in `loop_step`</span>
<span class="linenos">94</span><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Got final value: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">amongoc_box_cast</span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">));</span>
<span class="linenos">95</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">96</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">97</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="initiating-the-program">
<h2>Initiating the Program<a class="headerlink" href="#initiating-the-program" title="Link to this heading">#</a></h2>
<p>We declare our shared app state as a struct type. This is passed through the
program using a pointer:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 9</span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">10</span><span class="w">    </span><span class="c1">// The countdown to zero</span>
<span class="linenos">11</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">countdown</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">    </span><span class="c1">// The event loop for the operation</span>
<span class="linenos">13</span><span class="w">    </span><span class="kt">amongoc_loop</span><span class="o">*</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
<span class="linenos">14</span><span class="w">    </span><span class="c1">// Fibonacci state</span>
<span class="linenos">15</span><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="linenos">16</span><span class="p">}</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
</pre></div>
</div>
<p>After basic command-line argument processing, we initialize the event loop and
application state for the program:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">67</span><span class="w">    </span><span class="c1">// Create a default loop</span>
<span class="linenos">68</span><span class="w">    </span><span class="kt">amongoc_loop</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
<span class="linenos">69</span><span class="w">    </span><span class="nf">amongoc_default_loop_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">loop</span><span class="p">);</span>
<span class="linenos">70</span>
<span class="linenos">71</span><span class="w">    </span><span class="c1">// Seed the initial sum</span>
<span class="linenos">72</span><span class="w">    </span><span class="n">state</span><span class="w"> </span><span class="n">app_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">countdown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delay</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
</pre></div>
</div>
<p>In the sample program, the looping operation is initiated here:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">74</span><span class="w">    </span><span class="c1">// Start the loop</span>
<span class="linenos">75</span><span class="w">    </span><span class="kt">amongoc_emitter</span><span class="w"> </span><span class="n">em</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop_step</span><span class="p">(</span><span class="nf">amongoc_box_pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">app_state</span><span class="p">),</span><span class="w"> </span><span class="no">amongoc_okay</span><span class="p">,</span><span class="w"> </span><span class="no">amongoc_nil</span><span class="p">);</span>
</pre></div>
</div>
<p>We pass <a class="reference internal" href="../../ref/status/#_CPPv412amongoc_okay" title="amongoc_okay"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_okay</span></code></a> and <a class="reference internal" href="../../ref/box/#_CPPv411amongoc_nil" title="amongoc_nil"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_nil</span></code></a> as the initial “result” values. We pass
a pointer to our application state as the first argument using
<a class="reference internal" href="../../ref/box/#_CPPv419amongoc_box_pointerPKv" title="amongoc_box_pointer"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_box_pointer()</span></code></a>.</p>
</section>
<section id="loop-stepping">
<h2>Loop Stepping<a class="headerlink" href="#loop-stepping" title="Link to this heading">#</a></h2>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">loop_step</span></code> function is called both <em>initialy</em> and
<em>subsequently</em> for each sub-operation. The signature is written in such a way
that it is valid as an <a class="reference internal" href="../../ref/async/#_CPPv423amongoc_let_transformer" title="amongoc_let_transformer"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_let_transformer</span></code></a> function. It is possible that
your program will need a separate function to initiate your loop.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">18</span><span class="cm">/** loop_step()</span>
<span class="linenos">19</span><span class="cm"> * @brief Handle each step of our looping operation</span>
<span class="linenos">20</span><span class="cm"> *</span>
<span class="linenos">21</span><span class="cm"> * @param state_ptr Pointer to the `state` for the program</span>
<span class="linenos">22</span><span class="cm"> */</span>
<span class="linenos">23</span><span class="kt">amongoc_emitter</span><span class="w"> </span><span class="n">loop_step</span><span class="p">(</span><span class="kt">amongoc_box</span><span class="w"> </span><span class="n">state_ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">amongoc_status</span><span class="w"> </span><span class="n">prev_status</span><span class="p">,</span><span class="w"> </span><span class="kt">amongoc_box</span><span class="w"> </span><span class="n">prev_res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">24</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">prev_res</span><span class="p">;</span>
<span class="linenos">25</span><span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">prev_status</span><span class="p">;</span>
</pre></div>
</div>
<p>Our loop stepping function is called both to initiate the loop and to continue
the loop after the sub-operation has completed. Because our initiation and our
operation (<a class="reference internal" href="../../ref/async/#_CPPv422amongoc_schedule_laterP12amongoc_loop8timespec" title="amongoc_schedule_later"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_schedule_later()</span></code></a>) both give us <a class="reference internal" href="../../ref/box/#_CPPv411amongoc_nil" title="amongoc_nil"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_nil</span></code></a>, we do not need
to handle the result value (passed as the third parameter) and we can simply
discard it.</p>
<section id="printing-a-mesage-accumulating-a-sum">
<h3>Printing a Mesage &amp; Accumulating a Sum<a class="headerlink" href="#printing-a-mesage-accumulating-a-sum" title="Link to this heading">#</a></h3>
<p>We then extract our application state, perform some arithmetic, and print a
progress message to the user.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">26</span><span class="w">    </span><span class="c1">// Print our status</span>
<span class="linenos">27</span><span class="w">    </span><span class="n">state</span><span class="o">*</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">amongoc_box_cast</span><span class="p">(</span><span class="n">state</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">state_ptr</span><span class="p">);</span>
<span class="linenos">28</span><span class="w">    </span><span class="c1">// Compute the next sum and shift our numbers</span>
<span class="linenos">29</span><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">;</span>
<span class="linenos">30</span><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">;</span>
<span class="linenos">31</span><span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">;</span>
<span class="linenos">32</span><span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">b</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%d seconds remain, current value: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">countdown</span><span class="p">,</span><span class="w"> </span><span class="n">cur</span><span class="p">);</span>
</pre></div>
</div>
<p>This will assure the user that the application is running.</p>
</section>
<section id="checking-the-stop-condition">
<h3>Checking the Stop Condition<a class="headerlink" href="#checking-the-stop-condition" title="Link to this heading">#</a></h3>
<p>While we <em>could</em> loop forever, our program only wants to wait a limited amount
of time. We use a branch and <a class="reference internal" href="../../ref/async/#_CPPv412amongoc_just14amongoc_status11amongoc_box14mlib_allocator" title="amongoc_just"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_just()</span></code></a> to terminate the loop when our
countdown reaches zero.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">35</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">countdown</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">36</span><span class="w">        </span><span class="c1">// No more looping to do. Return a final null result</span>
<span class="linenos">37</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">amongoc_just</span><span class="p">(</span><span class="no">amongoc_okay</span><span class="p">,</span>
<span class="linenos">38</span><span class="w">                            </span><span class="nf">amongoc_box_uint64</span><span class="p">(</span><span class="n">cur</span><span class="p">),</span>
<span class="linenos">39</span><span class="w">                            </span><span class="nf">amongoc_loop_get_allocator</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">loop</span><span class="p">));</span>
<span class="linenos">40</span><span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../ref/async/#_CPPv412amongoc_just14amongoc_status11amongoc_box14mlib_allocator" title="amongoc_just"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_just()</span></code></a> function creates a pseudo-async operation that resolves
immediately with the given result. Here, we create a successful status with
<a class="reference internal" href="../../ref/status/#_CPPv412amongoc_okay" title="amongoc_okay"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_okay</span></code></a> and use <a class="reference internal" href="../../ref/box/#_CPPv418amongoc_box_uint648uint64_t" title="amongoc_box_uint64"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_box_uint64()</span></code></a> to create a box that stores the
final calculation. This result value box will appear at the end of our loop.</p>
</section>
<section id="starting-a-timer">
<h3>Starting a Timer<a class="headerlink" href="#starting-a-timer" title="Link to this heading">#</a></h3>
<p>If our countdown is not finished, we use <a class="reference internal" href="../../ref/async/#_CPPv422amongoc_schedule_laterP12amongoc_loop8timespec" title="amongoc_schedule_later"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_schedule_later()</span></code></a> to start
another delay:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">41</span><span class="w">    </span><span class="c1">// Decrement the counter and start a sleep of one second</span>
<span class="linenos">42</span><span class="w">    </span><span class="o">--</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">countdown</span><span class="p">;</span>
<span class="linenos">43</span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">timespec</span><span class="w"> </span><span class="n">dur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">tv_sec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<span class="linenos">44</span><span class="w">    </span><span class="kt">amongoc_emitter</span><span class="w"> </span><span class="n">em</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nf">amongoc_schedule_later</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">dur</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../ref/async/#_CPPv422amongoc_schedule_laterP12amongoc_loop8timespec" title="amongoc_schedule_later"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_schedule_later()</span></code></a> creates an operation that will start a timer for the
given duration and then complete with <a class="reference internal" href="../../ref/box/#_CPPv411amongoc_nil" title="amongoc_nil"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_nil</span></code></a> when the timer fires.</p>
</section>
<section id="continuing-the-loop">
<h3>Continuing the Loop<a class="headerlink" href="#continuing-the-loop" title="Link to this heading">#</a></h3>
<p>The core looping behavior is handled by <a class="reference internal" href="../../ref/async/#_CPPv411amongoc_let15amongoc_emitter19amongoc_async_flags14mlib_allocator11amongoc_box23amongoc_let_transformer" title="amongoc_let"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_let()</span></code></a>, a building-block of
asynchrony that creates allows the completion of an asynchronous operation to
initiate a new operation to continue the program:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">45</span><span class="w">    </span><span class="c1">// Connect the sleep to this function so that we will be called again after</span>
<span class="linenos">46</span><span class="w">    </span><span class="c1">// the delay has elapsed. Return this as the new operation for the loop.</span>
<span class="linenos">47</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">amongoc_let</span><span class="p">(</span><span class="n">em</span><span class="p">,</span>
</pre></div>
</div>
<p>This connects the completion of the timeout from <a class="reference internal" href="../../ref/async/#_CPPv422amongoc_schedule_laterP12amongoc_loop8timespec" title="amongoc_schedule_later"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_schedule_later()</span></code></a> to a
continuation via <code class="docutils literal notranslate"><span class="pre">loop_step</span></code>. The operation returned by <code class="docutils literal notranslate"><span class="pre">loop_step</span></code> becomes
the result of the emitter returned by <a class="reference internal" href="../../ref/async/#_CPPv411amongoc_let15amongoc_emitter19amongoc_async_flags14mlib_allocator11amongoc_box23amongoc_let_transformer" title="amongoc_let"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_let()</span></code></a>.</p>
<p>Since our <code class="docutils literal notranslate"><span class="pre">loop_step</span></code> can return another operation initiated by <a class="reference internal" href="../../ref/async/#_CPPv411amongoc_let15amongoc_emitter19amongoc_async_flags14mlib_allocator11amongoc_box23amongoc_let_transformer" title="amongoc_let"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_let()</span></code></a>,
the emitter from <a class="reference internal" href="../../ref/async/#_CPPv411amongoc_let15amongoc_emitter19amongoc_async_flags14mlib_allocator11amongoc_box23amongoc_let_transformer" title="amongoc_let"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_let()</span></code></a> will loop back on itself until the returned
emitter resolves in some other fashion (in our case, <a class="reference internal" href="../../ref/async/#_CPPv412amongoc_just14amongoc_status11amongoc_box14mlib_allocator" title="amongoc_just"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_just()</span></code></a>, or if
there is an error condition, specified by <a class="reference internal" href="../../ref/async/#_CPPv4N19amongoc_async_flags28amongoc_async_forward_errorsE" title="amongoc_async_forward_errors"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_async_forward_errors</span></code></a>).</p>
</section>
</section>
<section id="starting-and-running-the-loop">
<h2>Starting and Running the Loop<a class="headerlink" href="#starting-and-running-the-loop" title="Link to this heading">#</a></h2>
<p>Our looping operation has a final result value, so we will want to create and
tie storage for it. We do this using <a class="reference internal" href="../../ref/async/#_CPPv411amongoc_tie15amongoc_emitterP14amongoc_statusP11amongoc_box14mlib_allocator" title="amongoc_tie"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_tie()</span></code></a>, which will also create the
final <a class="reference internal" href="../../ref/operation/#_CPPv417amongoc_operation" title="amongoc_operation"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_operation</span></code></a> from the looping emitter we created from initiating
the loop.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">76</span><span class="w">    </span><span class="c1">// Tie the final result for later, and start the program</span>
<span class="linenos">77</span><span class="w">    </span><span class="kt">amongoc_status</span><span class="w">    </span><span class="n">status</span><span class="p">;</span>
<span class="linenos">78</span><span class="w">    </span><span class="kt">amongoc_box</span><span class="w">       </span><span class="n">result</span><span class="p">;</span>
<span class="linenos">79</span><span class="w">    </span><span class="kt">amongoc_operation</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">amongoc_tie</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="no">mlib_default_allocator</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../ref/async/#_CPPv411amongoc_tie15amongoc_emitterP14amongoc_statusP11amongoc_box14mlib_allocator" title="amongoc_tie"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_tie()</span></code></a> will attach a handler to the emitter that will store the final
result and status in the pointed-to location when the operation completes.</p>
<section id="starting-the-operation">
<h3>Starting the Operation<a class="headerlink" href="#starting-the-operation" title="Link to this heading">#</a></h3>
<p>When next execute <a class="reference internal" href="../../ref/operation/#_CPPv413amongoc_startP17amongoc_operation" title="amongoc_start"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_start()</span></code></a> on the returned operation object:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">80</span><span class="w">    </span><span class="nf">amongoc_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">op</span><span class="p">);</span>
</pre></div>
</div>
<p>This will launch the operation on the event loop. The program isn’t running yet,
though, as the default event loop requires a thread to execute it.</p>
</section>
<section id="running-the-loop-and-finalizing-the-operation">
<h3>Running the Loop and Finalizing the Operation<a class="headerlink" href="#running-the-loop-and-finalizing-the-operation" title="Link to this heading">#</a></h3>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">81</span><span class="w">    </span><span class="c1">// Run the program within the event loop</span>
<span class="linenos">82</span><span class="w">    </span><span class="nf">amongoc_default_loop_run</span><span class="p">(</span><span class="o">&amp;</span><span class="n">loop</span><span class="p">);</span>
<span class="linenos">83</span><span class="w">    </span><span class="nf">amongoc_operation_delete</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>
<span class="linenos">84</span><span class="w">    </span><span class="nf">amongoc_default_loop_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">loop</span><span class="p">);</span>
</pre></div>
</div>
<p>The call to <a class="reference internal" href="../../ref/loop/#_CPPv424amongoc_default_loop_runP12amongoc_loop" title="amongoc_default_loop_run"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_default_loop_run()</span></code></a> will execute the operations stored in
the event loop and return when all operations are complete. We are then safe to
destroy the operation with <a class="reference internal" href="../../ref/operation/#_CPPv424amongoc_operation_delete17amongoc_operation" title="amongoc_operation_delete"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_operation_delete()</span></code></a>, and we can discard the
event loop with <a class="reference internal" href="../../ref/loop/#_CPPv428amongoc_default_loop_destroyP12amongoc_loop" title="amongoc_default_loop_destroy"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_default_loop_destroy()</span></code></a>.</p>
</section>
</section>
<section id="error-handling-and-printing-the-final-result">
<h2>Error Handling and Printing the Final Result<a class="headerlink" href="#error-handling-and-printing-the-final-result" title="Link to this heading">#</a></h2>
<p>After the emitter used with <a class="reference internal" href="../../ref/async/#_CPPv411amongoc_tie15amongoc_emitterP14amongoc_statusP11amongoc_box14mlib_allocator" title="amongoc_tie"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_tie()</span></code></a> has completed, its final result
status and value are stored in the pointed-to storage, ready to be read by the
program. We check for errors, either printing the error message or printing the
final result:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">86</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">amongoc_is_error</span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">87</span><span class="w">        </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">amongoc_status_strdup_message</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="linenos">88</span><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;error: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">89</span><span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">90</span><span class="w">        </span><span class="nf">amongoc_box_destroy</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="linenos">91</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="linenos">92</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">93</span><span class="w">        </span><span class="c1">// Get the value returned with `amongoc_just` in `loop_step`</span>
<span class="linenos">94</span><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Got final value: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">amongoc_box_cast</span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">));</span>
<span class="linenos">95</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">96</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>We use <a class="reference internal" href="../../ref/status/#_CPPv416amongoc_is_error14amongoc_status" title="amongoc_is_error"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_is_error()</span></code></a> to test the final status for an error condition. If it
is an error, we get and print the error message to stderr, and we must destroy
the final result box because it may contain an unspecified value related to the
error, but we don’t want to do anything with it.</p>
<p>In the success case, we extract the value returned in <a class="reference internal" href="../../ref/async/#_CPPv412amongoc_just14amongoc_status11amongoc_box14mlib_allocator" title="amongoc_just"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_just()</span></code></a> as a
<code class="docutils literal notranslate"><span class="pre">uint64_t</span></code> and print it to stdout. Note that because the box returned by
<a class="reference internal" href="../../ref/box/#_CPPv418amongoc_box_uint648uint64_t" title="amongoc_box_uint64"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">amongoc_box_uint64()</span></code></a> is <a class="reference internal" href="../../ref/box/#box-trivial"><span class="std std-ref">trivial</span></a>, we can safely discard the
box without destroying it.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Looping Example Output</span><a class="headerlink" href="#id2" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>looping.example.exe<span class="w"> </span><span class="m">15</span>
<span class="go">15 seconds remain, current value: 0</span>
<span class="go">14 seconds remain, current value: 1</span>
<span class="go">13 seconds remain, current value: 1</span>
<span class="go">12 seconds remain, current value: 2</span>
<span class="go">11 seconds remain, current value: 3</span>
<span class="go">10 seconds remain, current value: 5</span>
<span class="go">9 seconds remain, current value: 8</span>
<span class="go">8 seconds remain, current value: 13</span>
<span class="go">7 seconds remain, current value: 21</span>
<span class="go">6 seconds remain, current value: 34</span>
<span class="go">5 seconds remain, current value: 55</span>
<span class="go">4 seconds remain, current value: 89</span>
<span class="go">3 seconds remain, current value: 144</span>
<span class="go">2 seconds remain, current value: 233</span>
<span class="go">1 seconds remain, current value: 377</span>
<span class="go">0 seconds remain, current value: 610</span>
<span class="go">Got final value: 610</span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../connect/"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Connect to a Server</p>
      </div>
    </a>
    <a class="right-next"
       href="../../ref/"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-example-program">The Example Program</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initiating-the-program">Initiating the Program</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loop-stepping">Loop Stepping</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#printing-a-mesage-accumulating-a-sum">Printing a Mesage &amp; Accumulating a Sum</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-stop-condition">Checking the Stop Condition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-a-timer">Starting a Timer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#continuing-the-loop">Continuing the Loop</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-and-running-the-loop">Starting and Running the Loop</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-the-operation">Starting the Operation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-loop-and-finalizing-the-operation">Running the Loop and Finalizing the Operation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling-and-printing-the-final-result">Error Handling and Printing the Final Result</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MongoDB
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, MongoDB.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>